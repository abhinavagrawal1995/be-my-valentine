<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Valentine's Request</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Permanent+Marker&family=Playfair+Display:ital,wght@0,600;0,700;1,400&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@3/tsparticles.bundle.min.js"></script>

    <style>
        /* ==================================================
           CSS Variables & Global Reset
           ================================================== */
        :root {
            /* Act 1: Cyber Terminal */
            --bg-cyber: #1A1A1A;
            --text-cyber: #E0E0E0;
            --accent-neon: #00FF41;
            --error-red: #FF003C;
            --font-terminal: 'Space Mono', monospace;
            
            /* Act 2: Modern Romance */
            --bg-romance: linear-gradient(135deg, #FFF0F5 0%, #FFE4E1 100%);
            --text-crimson: #8B0000;
            --btn-blush: #FFB6C1;
            --btn-blush-hover: #FFC0CB;
            --font-heading: 'Playfair Display', serif;
            --font-body: 'Inter', sans-serif;

            /* Act 3: Finale */
            --bg-finale: radial-gradient(circle at center, #2a0815 0%, #0a0a0a 100%);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden; /* Prevent body scroll, handle scroll in containers */
            background-color: var(--bg-cyber); /* Default start */
        }

        /* Act Containers */
        .act-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100dvh;
            display: none; /* Hidden by default */
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .act-container.active {
            display: flex;
            opacity: 1;
            z-index: 10;
        }

        /* ==================================================
           ACT 1: Wife Authentication
           ================================================== */
        #act1 {
            background-color: var(--bg-cyber);
            color: var(--text-cyber);
            font-family: var(--font-terminal);
            padding: 2rem 1.5rem;
            align-items: center;
        }

        .terminal-content {
            width: 100%;
            max-width: 400px;
            margin: auto;
            display: flex;
            flex-direction: column;
            gap: 2rem;
            position: relative;
            flex-grow: 1;
            justify-content: center;
        }

        .sys-header {
            font-size: 1rem;
            line-height: 1.5;
            color: var(--accent-neon);
            text-align: left;
            border-bottom: 1px solid var(--accent-neon);
            padding-bottom: 1rem;
            text-shadow: 0 0 5px rgba(0, 255, 65, 0.3);
        }

        .question-card {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            width: 100%;
            animation: slideInRight 0.5s ease forwards;
        }

        .question-card.slide-out {
            animation: slideOutLeft 0.5s ease forwards;
        }

        .q-text {
            font-size: 1.1rem;
            font-weight: 700;
            line-height: 1.4;
        }

        .options-group {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .option-btn {
            background: transparent;
            color: var(--text-cyber);
            border: 1px solid #444;
            padding: 1rem;
            font-family: var(--font-terminal);
            font-size: 0.95rem;
            text-align: left;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            line-height: 1.3;
        }

        .option-btn:active {
            background: rgba(255, 255, 255, 0.1);
        }

        .option-btn.selected-correct {
            background: var(--accent-neon);
            color: var(--bg-cyber);
            border-color: var(--accent-neon);
        }

        .error-msg {
            color: var(--error-red);
            font-weight: 700;
            font-size: 0.9rem;
            text-align: center;
            opacity: 0;
            height: 20px; /* reserve space */
            transition: opacity 0.3s;
        }

        .error-msg.show {
            opacity: 1;
            animation: glitch 0.3s linear infinite alternate;
        }

        .success-msg {
            color: var(--accent-neon);
            font-size: 1.2rem;
            font-weight: 700;
            text-align: center;
            display: none;
            text-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
            animation: pulse-neon 1.5s infinite;
        }

        /* Animations Act 1 */
        @keyframes slideInRight {
            from { transform: translateX(50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutLeft {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(-50px); opacity: 0; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
        }
        .shake { animation: shake 0.4s; }
        @keyframes pulse-neon {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* ==================================================
           ACT 2: Main Event
           ================================================== */
        #act2 {
            background: var(--bg-romance);
            justify-content: center;
            align-items: center;
            padding: 2rem;
            text-align: center;
        }

        .romance-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 400px;
            gap: 2rem;
        }

        .romance-heading {
            font-family: var(--font-heading);
            color: var(--text-crimson);
            font-size: 2.5rem;
            line-height: 1.2;
            margin-bottom: 1rem;
        }

        .action-group {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            width: 100%;
            align-items: center;
            transition: all 0.5s ease;
        }

        .btn-romance {
            font-family: var(--font-body);
            font-weight: 600;
            font-size: 1.2rem;
            padding: 1rem 2.5rem;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            width: 80%;
            max-width: 300px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        #yes-btn {
            background-color: var(--btn-blush);
            color: var(--text-crimson);
        }

        #yes-btn:active {
            transform: scale(0.95);
        }

        #no-btn {
            background-color: transparent;
            color: var(--text-crimson);
            border: 2px solid var(--btn-blush);
            font-size: 1rem; /* Starts slightly smaller */
            padding: 0.8rem 1.5rem;
        }

        .footnote {
            font-family: var(--font-body);
            font-size: 0.8rem;
            color: rgba(139, 0, 0, 0.6);
            font-style: italic;
            margin-top: 1rem;
        }

        /* Dynamic states for YES button when it expands */
        .yes-expanded {
            position: fixed !important;
            bottom: 0;
            left: 0;
            width: 100vw !important;
            max-width: 100vw !important;
            height: 50dvh !important;
            border-radius: 30px 30px 0 0 !important;
            font-size: 2.5rem !important;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: gentle-pulse 2s infinite alternate !important;
            z-index: 20;
            margin: 0 !important;
        }

        @keyframes gentle-pulse {
            0% { box-shadow: 0 -10px 30px rgba(255, 182, 193, 0.4); background-color: var(--btn-blush); }
            100% { box-shadow: 0 -15px 50px rgba(255, 182, 193, 0.8); background-color: #FFC0CB; }
        }

        /* ==================================================
           ACT 3: Finale
           ================================================== */
        #act3 {
            background:
                radial-gradient(circle at 14% 10%, rgba(255, 199, 216, 0.32), transparent 35%),
                radial-gradient(circle at 86% 16%, rgba(255, 230, 188, 0.24), transparent 34%),
                linear-gradient(180deg, #FFF9FC 0%, #FFEFF2 100%);
            justify-content: center;
            align-items: center;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .act3-hearts {
            position: absolute;
            inset: 0;
            z-index: 1;
            pointer-events: none;
        }

        .polaroid-stage {
            position: relative;
            width: 100%;
            max-width: 380px;
            height: min(70dvh, 560px);
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
            overflow: visible;
            z-index: 3;
        }

        .polaroid {
            position: absolute;
            background: white;
            padding: 10px 10px 54px 10px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            border-radius: 3px;
            width: min(72vw, 310px);
            aspect-ratio: 3/4;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.75) translateY(-95px) rotate(0deg);
            transition: transform 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.55s ease;
            z-index: 4;
        }

        .polaroid--hero {
            left: 50%;
            top: 45%;
            z-index: 6;
        }

        .polaroid-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background-color: #ddd; /* Placeholder color before load */
            border: 1px solid #eee;
            display: block;
        }

        .polaroid-caption {
            position: absolute;
            left: 12px;
            right: 12px;
            bottom: 14px;
            text-align: center;
            font-family: 'Permanent Marker', cursive;
            font-size: clamp(1.02rem, 3.8vw, 1.28rem);
            color: #2f3f86;
            letter-spacing: 0.02em;
            transform: rotate(-1.7deg);
            text-shadow: 0 1px 0 rgba(0,0,0,0.08);
        }

        .finale-text {
            font-family: var(--font-heading);
            color: #6a1838;
            font-size: 1.22rem;
            text-align: center;
            width: min(90%, 460px);
            position: absolute;
            bottom: max(5%, env(safe-area-inset-bottom));
            text-shadow: 0 1px 0 rgba(255,255,255,0.7);
            opacity: 0;
            transition: opacity 1.5s ease;
            z-index: 10;
            line-height: 1.4;
            background: rgba(255, 250, 246, 0.78);
            border: 1px solid rgba(200, 121, 150, 0.22);
            padding: 0.72rem 0.86rem;
            border-radius: 15px;
            backdrop-filter: blur(4px);
            box-shadow: 0 8px 24px rgba(161, 77, 114, 0.12);
        }

        @media (max-width: 380px) {
            .finale-text {
                font-size: 1.18rem;
            }
        }

    </style>
</head>
<body>

    <div id="act1" class="act-container active">
        <div class="terminal-content">
            <h1 class="sys-header">Wife Authentication Required. To proceed to your scheduled Valentine's Day request, please verify your identity.</h1>
            
            <div id="quiz-container">
                </div>
            
            <div id="auth-error" class="error-msg">Imposter Detected. Try again.</div>
            <div id="auth-success" class="success-msg">Authentication Successful. Access Granted.</div>
        </div>
    </div>

    <div id="act2" class="act-container">
        <div class="romance-content">
            <h1 class="romance-heading">Will you be my Valentine?</h1>
            
            <div class="action-group" id="action-group">
                <button id="yes-btn" class="btn-romance">YES</button>
                <button id="no-btn" class="btn-romance">NO</button>
            </div>
            
            <p class="footnote">(Warning: Do NOT press the 'No' button under any circumstances.)</p>
        </div>
    </div>

    <div id="act3" class="act-container">
        <div class="act3-hearts" id="act3-hearts" aria-hidden="true"></div>
        <div class="polaroid-stage">
            <div class="polaroid polaroid--hero" id="p1">
                <img class="polaroid-photo" src="img.jpg" alt="Memory 1">
                <div class="polaroid-caption">I Love youuuu!</div>
            </div>
        </div>
        <h2 class="finale-text" id="finale-msg">I still can't believe how lucky I am to call you mine... <br/> I promise to love you more every day, my forever Valentine. <3</h2>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            /* ------------------------------------------------
               Utility Functions
               ------------------------------------------------ */
            // Fisher-Yates array shuffle for randomizing options
            function shuffle(array) {
                let currentIndex = array.length, randomIndex;
                while (currentIndex != 0) {
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;
                    [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
                }
                return array;
            }

            /* ------------------------------------------------
               ACT 1 Logic
               ------------------------------------------------ */
            const questionsData = [
                {
                    q: "If we have dinner reservations at 7:00 PM, what time are we actually leaving the house?",
                    opts: [
                        { text: "6:45 PM", correct: false },
                        { text: "7:00 PM exactly", correct: false },
                        { text: "Whenever you are finally happy with your outfit", correct: true }
                    ]
                },
                {
                    q: "Identity Check: What is the exact, mandatory coffee order required for you to function?",
                    opts: [
                        { text: "A standard vanilla latte", correct: false },
                        { text: "Just black coffee", correct: false },
                        { text: "A 12-ounce cappuccino with exactly 3 shots of espresso", correct: true }
                    ]
                },
                {
                    q: "Verification: We are embarking on a road trip. What are we listening to for the duration of the drive?",
                    opts: [
                        { text: "A carefully curated playlist of nostalgic 90s throwbacks", correct: false },
                        { text: "Today's Top 50 Global Hits", correct: false },
                        { text: "Exactly one (1) song that you are currently obsessed with, played on an endless, unbreakable loop until we arrive", correct: true }
                    ]
                }
            ];

            let currentQIndex = 0;
            const quizContainer = document.getElementById('quiz-container');
            const authError = document.getElementById('auth-error');
            const authSuccess = document.getElementById('auth-success');
            const sysHeader = document.querySelector('.sys-header');

            function renderQuestion(index) {
                quizContainer.innerHTML = ''; // Clear previous
                
                const qData = questionsData[index];
                
                // Shuffle options for this render
                const shuffledOpts = shuffle([...qData.opts]);

                // Build Card
                const card = document.createElement('div');
                card.className = 'question-card';
                
                const qText = document.createElement('div');
                qText.className = 'q-text';
                qText.textContent = qData.q;
                card.appendChild(qText);

                const optsGroup = document.createElement('div');
                optsGroup.className = 'options-group';

                shuffledOpts.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.textContent = opt.text;
                    btn.onclick = () => handleAnswerOptionClick(btn, opt.correct, card);
                    optsGroup.appendChild(btn);
                });

                card.appendChild(optsGroup);
                quizContainer.appendChild(card);
            }

            function handleAnswerOptionClick(btnElement, isCorrect, cardElement) {
                // Clear previous errors
                authError.classList.remove('show');
                
                if (isCorrect) {
                    btnElement.classList.add('selected-correct');
                    // Disable all buttons in this card
                    const allBtns = cardElement.querySelectorAll('.option-btn');
                    allBtns.forEach(b => b.style.pointerEvents = 'none');

                    setTimeout(() => {
                        cardElement.classList.add('slide-out');
                        setTimeout(() => {
                            currentQIndex++;
                            if (currentQIndex < questionsData.length) {
                                renderQuestion(currentQIndex);
                            } else {
                                handleAct1Success();
                            }
                        }, 400); // Wait for slide out animation
                    }, 500); // Small pause to show correct color
                } else {
                    // Wrong answer
                    btnElement.classList.remove('shake');
                    void btnElement.offsetWidth; // trigger reflow
                    btnElement.classList.add('shake');
                    
                    authError.classList.add('show');
                }
            }

            function handleAct1Success() {
                quizContainer.style.display = 'none';
                sysHeader.style.display = 'none';
                authError.style.display = 'none';
                authSuccess.style.display = 'block';

                setTimeout(() => {
                    transitionAct('act1', 'act2');
                }, 2000);
            }

            // Init Act 1
            renderQuestion(0);


            /* ------------------------------------------------
               Act Transitions
               ------------------------------------------------ */
            function transitionAct(fromId, toId) {
                const fromEl = document.getElementById(fromId);
                const toEl = document.getElementById(toId);

                fromEl.style.opacity = '0';
                setTimeout(() => {
                    fromEl.classList.remove('active');
                    toEl.classList.add('active');
                    // Force reflow
                    void toEl.offsetWidth;
                    toEl.style.opacity = '1';

                    if(toId === 'act3') {
                        initFinale();
                    }
                }, 800); // matches CSS transition time
            }


            /* ------------------------------------------------
               ACT 2 Logic
               ------------------------------------------------ */
            const yesBtn = document.getElementById('yes-btn');
            const noBtn = document.getElementById('no-btn');
            const actionGroup = document.getElementById('action-group');
            let act3HeartsInitialized = false;
            let noTapCount = 0;

            const noProgressionTexts = [
                "Wait, seriously?",
                "Are you sure? We literally live together.",
                "Think about the pizza.",
                "I am legally your husband."
            ];

            noBtn.addEventListener('click', (e) => {
                noTapCount++;
                
                if (noTapCount <= 4) {
                    // Update Text
                    noBtn.textContent = noProgressionTexts[noTapCount - 1];
                    
                    // Shrink NO, Grow YES visually using inline styles
                    // Base size starts at 1, Yes increases, No decreases
                    const noScale = 1 - (noTapCount * 0.1); 
                    const yesScale = 1 + (noTapCount * 0.15);
                    
                    noBtn.style.transform = `scale(${noScale})`;
                    noBtn.style.padding = `${0.8 - (noTapCount*0.1)}rem ${1.5 - (noTapCount*0.1)}rem`;
                    
                    yesBtn.style.transform = `scale(${yesScale})`;
                }
                
                if (noTapCount === 5) {
                    // Final State: NO disappears, YES takes over
                    noBtn.style.display = 'none';
                    actionGroup.style.gap = '0';
                    actionGroup.style.marginTop = '2rem';
                    
                    yesBtn.style.transform = 'none'; // reset scale transform
                    yesBtn.classList.add('yes-expanded');
                }
            });

            yesBtn.addEventListener('click', () => {
                if (noTapCount === 0) {
                    alert("Such a quick YES? Are you sure you want to make it so easy?");
                }
                transitionAct('act2', 'act3');
            });


            /* ------------------------------------------------
               ACT 3 Logic (Finale)
               ------------------------------------------------ */
            function initAct3Hearts() {
                if (act3HeartsInitialized) return;
                tsParticles.load('act3-hearts', {
                    fullScreen: { enable: false },
                    detectRetina: true,
                    fpsLimit: 60,
                    particles: {
                        number: { value: 30, density: { enable: true, width: 800, height: 1000 } },
                        color: { value: ['#f05d97', '#f58db2', '#f3a8c2'] },
                        shape: {
                            type: 'character',
                            options: {
                                character: {
                                    value: ['â™¥'],
                                    font: 'Verdana',
                                    style: '',
                                    weight: '500',
                                    fill: true
                                }
                            }
                        },
                        opacity: {
                            value: { min: 0.24, max: 0.48 },
                            animation: { enable: true, speed: 0.65, minimumValue: 0.16, sync: false }
                        },
                        size: { value: { min: 12, max: 20 } },
                        move: {
                            enable: true,
                            speed: 0.85,
                            direction: 'top',
                            random: true,
                            outModes: { default: 'out' },
                            straight: false
                        }
                    },
                    interactivity: {
                        events: {
                            onHover: { enable: false },
                            onClick: { enable: false },
                            resize: { enable: true }
                        }
                    },
                    background: { color: { value: 'transparent' } }
                });

                act3HeartsInitialized = true;
            }

            function initFinale() {
                initAct3Hearts();

                // 1. Trigger Confetti
                const duration = 3000;
                const end = Date.now() + duration;

                (function frame() {
                    confetti({
                        particleCount: 5,
                        angle: 60,
                        spread: 55,
                        origin: { x: 0, y: 0.8 },
                        colors: ['#FFB6C1', '#FF69B4', '#FFFFFF', '#FFD700']
                    });
                    confetti({
                        particleCount: 5,
                        angle: 120,
                        spread: 55,
                        origin: { x: 1, y: 0.8 },
                        colors: ['#FFB6C1', '#FF69B4', '#FFFFFF', '#FFD700']
                    });

                    if (Date.now() < end) {
                        requestAnimationFrame(frame);
                    }
                }());

                // 2. Reveal single hero polaroid
                const p1 = document.getElementById('p1');
                const finaleMsg = document.getElementById('finale-msg');
                const photoResetTransform = 'translate(-50%, -50%) scale(0.75) translateY(-95px) rotate(0deg)';

                p1.style.opacity = '0';
                p1.style.transform = photoResetTransform;
                finaleMsg.style.opacity = '0';

                setTimeout(() => {
                    p1.style.opacity = '1';
                    p1.style.transform = 'translate(-50%, -50%) scale(1) translateY(0) rotate(-4deg)';
                    p1.style.zIndex = '6';
                }, 350);

                // 3. Fade in final text
                setTimeout(() => {
                    finaleMsg.style.opacity = '1';
                }, 1200);
            }
        });
    </script>
</body>
</html>
